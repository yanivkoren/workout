<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>אימון כושר – ידידותי לנייד</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <style>
    :root {
      --bg:#0b0b0c; --card:#141518; --muted:#9aa3af; --accent:#4f8cff;
      --text:#e8eaf0; --success:#22c55e; --warn:#f59e0b; --danger:#ef4444;
    }
    @media (prefers-color-scheme: light) {
      :root { --bg:#f6f7fb; --card:#ffffff; --text:#111827; --muted:#6b7280; --accent:#2563eb; }
    }
    html, body { height: 100%; }
    body { background:var(--bg); color:var(--text); -webkit-tap-highlight-color: transparent; }

    /* ===== Top bar ===== */
    .topbar { position: sticky; top: 0; z-index: 20; backdrop-filter: blur(6px);
      background: color-mix(in oklab, var(--bg) 75%, transparent);
      border-bottom: 1px solid rgba(255,255,255,.06); padding: .75rem .5rem; }
    .app-title { font-weight: 800; letter-spacing: .5px; }

    /* ===== Search ===== */
    .search { background: var(--card); border-radius: 14px; border: 1px solid rgba(255,255,255,.06); }
    .search input { background: transparent; border: 0; color: var(--text); padding: .85rem 1rem; }
    .search input::placeholder{ color: var(--muted); }

    /* ===== Sections (accordion) ===== */
    .section-card { background: var(--card); border: 1px solid rgba(255,255,255,.06); border-radius: 16px; overflow: hidden; }
    .accordion-button { background: var(--card); color: var(--text); padding: 1rem; }
    .accordion-button:not(.collapsed) { color: var(--accent); box-shadow: none; }
    .accordion-body { padding: 0; }

    /* ===== Exercise list items (large touch targets) ===== */
    .exercise-item { display:flex; align-items:center; gap:.75rem; padding: .9rem 1rem; border-bottom:1px dashed rgba(255,255,255,.08); }
    .exercise-item:active { background: rgba(79,140,255,.08); }
    .pill { font-size: .75rem; padding:.25rem .5rem; border-radius: 999px; background: rgba(79,140,255,.12); color: var(--accent); }
    .ex-name { font-weight: 600; }
    .ex-sub { font-size: .85rem; color: var(--muted); }
    .open-btn { margin-inline-start:auto; }

    /* ===== Modal ===== */
    .modal-content { background: var(--card); color: var(--text); }
    .modal-fullscreen-sm-down .modal-content { background:#000; }
    .modal-header { border: 0; }
    .exercise-img-wrap { position: relative; width: 100%; background:#000; display:flex; align-items:center; justify-content:center; }
    .exercise-img { max-width: 100%; max-height: 62vh; object-fit: contain; display:block; }

    /* Info cards inside modal */
    .info-card { background: var(--card); border: 1px solid rgba(255,255,255,.06); border-radius: 12px; height:100%; }
    .info-card h6 { margin:0 0 .5rem 0; font-weight:700; color: var(--muted); font-size:.9rem; }

    /* Sticky controls at bottom of modal */
    .controls-bar { position: sticky; bottom: 0; background: color-mix(in oklab, var(--card) 92%, transparent);
      border-top: 1px solid rgba(255,255,255,.06); padding: .75rem .25rem; }
    .timer-display { font-size: 64px; line-height:1; font-weight: 900; color: var(--accent); text-align:center; }
    @media (min-width: 992px){ .timer-display { font-size: 80px; } }
    .btn-wide { min-width: 96px; padding:.8rem 1rem; }
    .btn-ghost { background: transparent; border:1px solid rgba(255,255,255,.15); color: var(--text); }

    /* Utilities */
    .muted { color: var(--muted); }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
  </style>
</head>
<body>

  <!-- Sticky top bar with search -->
  <div class="topbar">
    <div class="container">
      <div class="d-flex align-items-center gap-2">
        <h1 class="app-title h4 mb-0 flex-grow-1">רשימת תרגילים</h1>
        <button class="btn btn-sm btn-ghost" id="muteBtn" aria-pressed="false" title="השתק צליל">🔊</button>
      </div>
      <div class="search mt-2">
        <input type="search" id="searchInput" class="form-control" placeholder="חפש תרגיל / שריר..." aria-label="חיפוש" />
      </div>
    </div>
  </div>

  <div class="container my-3">
    <div class="accordion" id="sections"></div>
  </div>

  <!-- Modal: תמונה + הוראות + זמן/חזרות + טיימר (מסך מלא במובייל) -->
  <div class="modal fade" id="exerciseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">הדגמת תרגיל</h5>
          <button type="button" class="btn-close ms-auto" data-bs-dismiss="modal" aria-label="סגור" onclick="onModalClose()"></button>
        </div>

        <div class="modal-body">
          <div class="exercise-img-wrap mb-3">
            <img id="modalImage" class="exercise-img" src="" alt="תמונה של התרגיל">
          </div>

          <div class="row g-3">
            <div class="col-12 col-lg-6">
              <div class="info-card p-3">
                <h6>הוראות ביצוע</h6>
                <div id="modalInstructions" class="lh-lg">—</div>
              </div>
            </div>
            <div class="col-12 col-lg-6">
              <div class="info-card p-3">
                <h6>זמן/חזרות</h6>
                <div id="modalTimeReps">—</div>
              </div>
            </div>
          </div>

          <div class="controls-bar mt-3">
            <div class="container-fluid">
              <div class="row g-2 align-items-center">
                <div class="col-12 col-lg-3">
                  <div id="timerDisplay" class="timer-display">0</div>
                  <div class="text-center mt-1">
                    <span class="badge text-bg-info me-1" id="suggestSeconds">משך מוצע: —</span>
                    <span class="badge text-bg-secondary" id="suggestRounds">סטים: 1</span>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <div class="d-flex flex-wrap gap-2 justify-content-center">
                    <button class="btn btn-ghost btn-wide" onclick="startTimer(1)">1 שנ׳</button>
                    <button class="btn btn-ghost btn-wide" onclick="startTimer(3)">3 שנ׳</button>
                    <button class="btn btn-ghost btn-wide" onclick="startTimer(5)">5 שנ׳</button>
                    <button class="btn btn-ghost btn-wide" onclick="startTimer(10)">10 שנ׳</button>
                    <button id="startSuggestedBtn" class="btn btn-success btn-wide d-none" onclick="startSuggested()">לפי התרגיל</button>
                  </div>
                </div>
                <div class="col-12 col-lg-3">
                  <div class="d-flex flex-wrap gap-2 justify-content-center">
                    <button class="btn btn-warning btn-wide" id="pauseBtn" onclick="togglePause()">PAUSE</button>
                    <button class="btn btn-danger btn-wide" onclick="resetTimer()">RESET</button>
                  </div>
                </div>
              </div>
              <div class="text-center mt-1 muted"><small>מקשים: רווח = Pause/Resume · R = Reset</small></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- צליל סיום -->
  <audio id="beep" preload="auto">
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
  </audio>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ===== נתונים =====
    const CATEGORIES = [
      "חימום כללי","אירובי","חימום ייעודי","אימון כח","אימון שיווי משקל","אימון ליבה","מתיחות"
    ];
    const IMG_HAMSTRING = "https://www.inspireusafoundation.org/file/2023/09/seated-hamstring-stretch.gif";
    const IMG_CALF      = "https://www.inspireusafoundation.org/file/2022/12/wall-calf-stretch.gif";
    const IMG_SHOULDER  = "https://www.inspireusafoundation.org/file/2023/03/shoulder-rolls.gif";
    const IMG_DOORWAY   = "https://www.spotebi.com/wp-content/uploads/2015/01/doorway-stretch-exercise-illustration.jpg";

    const DATA = {
      "חימום כללי": [
        { muscle:"כללי", name:"March in Place", timeReps:"1 דקה × 1", instructions:"צעידה במקום, ידיים חופשיות", image:IMG_SHOULDER },
        { muscle:"כללי", name:"Arm Circles",    timeReps:"30 שניות × 2", instructions:"סיבובי כתפיים קדימה/אחורה", image:IMG_SHOULDER },
        { muscle:"כללי", name:"Hip Mobility",   timeReps:"30 שניות × 1", instructions:"סיבובי אגן והטיית אגן עדינה", image:IMG_CALF }
      ],
      "אירובי": [
        { muscle:"לב־ריאה", name:"Elliptical", timeReps:"5 דקות × 1", instructions:"קצב קל עד בינוני", image:IMG_CALF },
        { muscle:"לב־ריאה", name:"Bike",       timeReps:"5 דקות × 1", instructions:"סל\u05b4\u05b0\u05b3\u05bc\u05b3\u05b4ד 80–90, התנגדות קלה", image:IMG_SHOULDER },
        { muscle:"לב־ריאה", name:"Rowing",     timeReps:"3 דקות × 1", instructions:"קצב אחיד, דגש על גב", image:IMG_HAMSTRING }
      ],
      "חימום ייעודי": [
        { muscle:"גב עליון", name:"Scapular Retraction", timeReps:"30 שניות × 2", instructions:"קירוב שכמות עם גב נייטרלי", image:IMG_SHOULDER },
        { muscle:"ירך אחורית", name:"Hamstring Prep",   timeReps:"20 שניות × 2", instructions:"כיפוף ירך קל, ללא כאב", image:IMG_HAMSTRING },
        { muscle:"שוק", name:"Calf Prep",                timeReps:"20 שניות × 2", instructions:"עמידה מול קיר, עקב צמוד לרצפה", image:IMG_CALF }
      ],
      "אימון כח": [
        { muscle:"ליבה", name:"Plank",              timeReps:"30 שניות × 3", instructions:"קו ישר ראש–עקבים, בטן אסופה", image:IMG_SHOULDER },
        { muscle:"רגליים", name:"Wall Sit",        timeReps:"40 שניות × 2", instructions:"גב צמוד לקיר, 90° בברכיים", image:IMG_CALF },
        { muscle:"גב", name:"Isometric Row Hold",   timeReps:"20 שניות × 3", instructions:"משיכה ואחיזה, שכמות לאחור", image:IMG_HAMSTRING }
      ],
      "אימון שיווי משקל": [
        { muscle:"קרסול/ליבה", name:"Single-Leg Stand", timeReps:"30 שניות × 2", instructions:"עמידה על רגל אחת, מבט קדימה", image:IMG_SHOULDER },
        { muscle:"קרסול", name:"Tandem Stance",          timeReps:"30 שניות × 2", instructions:"רגל מול רגל בקו אחד", image:IMG_CALF },
        { muscle:"ירך", name:"Cossack Hold (קל)",        timeReps:"20 שניות × 2", instructions:"העברת משקל לצד עם אחיזה נמוכה", image:IMG_HAMSTRING }
      ],
      "אימון ליבה": [
        { muscle:"ליבה", name:"Dead Bug (Isometric)", timeReps:"30 שניות × 2", instructions:"נשיפה, גב ניטרלי, תנועת יד/רגל נגדית בהחזקת זווית", image:IMG_SHOULDER },
        { muscle:"ליבה", name:"Hollow Hold (קל)",     timeReps:"20 שניות × 3", instructions:"אגן אחורה, צלעות למטה, החזק", image:IMG_CALF },
        { muscle:"ליבה", name:"Side Plank (ברך)",     timeReps:"20 שניות × 2", instructions:"מרפק מתחת לכתף, קו אוזן–כתף–אגן–ברך", image:IMG_HAMSTRING }
      ],
      "מתיחות": [
        { muscle:"חזה", name:"Doorway Stretch",      timeReps:"30 שניות × 2", instructions:"ידיים על משקוף מעל קו הכתפיים", image:IMG_DOORWAY },
        { muscle:"שוק", name:"Calf Stretch (Wall)",  timeReps:"30 שניות × 2", instructions:"עקב אחורי צמוד לרצפה, פעם ברך ישרה ופעם כפופה", image:IMG_CALF },
        { muscle:"ירך אחורית", name:"Seated Hamstring", timeReps:"30 שניות × 2", instructions:"רגל ישרה, גב ארוך, התקדמות עד מתיחה נוחה", image:IMG_HAMSTRING }
      ]
    };

    // ===== Build accordion sections =====
    const acc = document.getElementById('sections');
    CATEGORIES.forEach((cat, idx) => {
      const catId = `cat-${idx}`;
      const item = document.createElement('div');
      item.className = 'accordion-item section-card';
      item.innerHTML = `
        <h2 class="accordion-header" id="${catId}-h">
          <button class="accordion-button ${idx? 'collapsed':''}" type="button" data-bs-toggle="collapse" data-bs-target="#${catId}-c" aria-expanded="${!idx}" aria-controls="${catId}-c">
            ${cat}
          </button>
        </h2>
        <div id="${catId}-c" class="accordion-collapse collapse ${idx? '':'show'}" aria-labelledby="${catId}-h" data-bs-parent="#sections">
          <div class="accordion-body">
            <div id="list-${catId}"></div>
          </div>
        </div>`;
      acc.appendChild(item);

      const listRoot = item.querySelector(`#list-${catId}`);
      (DATA[cat]||[]).forEach(ex => {
        const row = document.createElement('button');
        row.className = 'exercise-item w-100 text-start btn btn-link';
        row.innerHTML = `
          <span class="pill">${ex.muscle}</span>
          <span class="ex-name">${ex.name}</span>
          <span class="ex-sub">· ${ex.timeReps}</span>
          <span class="open-btn">›</span>`;
        row.addEventListener('click', () => openExercise(ex));
        listRoot.appendChild(row);
      });
    });

    // ===== Search filter =====
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      [...document.querySelectorAll('.exercise-item')].forEach(btn => {
        const txt = btn.textContent.toLowerCase();
        btn.style.display = txt.includes(q) ? '' : 'none';
      });
    });

    // ===== Modal + timer logic =====
    const exerciseModal = new bootstrap.Modal(document.getElementById('exerciseModal'));
    let suggestedSeconds = null, suggestedRounds = 1;
    let countdown = null, timeLeft = 0, isPaused = false, isRunning = false, remainingRounds = 1;
    let wakeLock = null; // Wake Lock API to keep screen on
    let muted = false;

    document.getElementById('muteBtn').addEventListener('click', () => {
      muted = !muted;
      const btn = document.getElementById('muteBtn');
      btn.textContent = muted ? '🔇' : '🔊';
      btn.setAttribute('aria-pressed', String(muted));
    });

    async function requestWakeLock(){
      try { if ('wakeLock' in navigator) { wakeLock = await navigator.wakeLock.request('screen'); } } catch(e){}
    }
    function releaseWakeLock(){ try { wakeLock?.release(); wakeLock = null; } catch(e){} }

    function openExercise(ex){
      document.getElementById('modalImage').src = ex.image;
      document.getElementById('modalTitle').textContent = `הדגמת תרגיל: ${ex.name}`;
      document.getElementById('modalInstructions').textContent = ex.instructions || '—';
      document.getElementById('modalTimeReps').textContent = ex.timeReps || '—';

      resetTimer();
      const { seconds, rounds } = parseTimeReps(ex.timeReps);
      suggestedSeconds = seconds; suggestedRounds = rounds;
      document.getElementById('timerDisplay').textContent = seconds || 0;
      document.getElementById('suggestSeconds').textContent = seconds? `משך מוצע: ${seconds} שניות` : 'משך מוצע: —';
      document.getElementById('suggestRounds').textContent  = `סטים: ${rounds}`;
      document.getElementById('startSuggestedBtn').classList.toggle('d-none', !seconds);

      exerciseModal.show();
      requestWakeLock();
    }

    function parseTimeReps(str){
      if (!str) return { seconds:0, rounds:1 };
      const minMatch = str.match(/(\d+)\s*(?:דק(?:ה|ות)?)/);
      const secMatch = str.match(/(\d+)\s*(?:שנ(?:י(?:ה|ות)?)?|ש׳)/);
      const multMatch= str.match(/[×xX]\s*(\d+)/);
      const minutes = minMatch ? parseInt(minMatch[1],10) : 0;
      const secondsOnly = secMatch ? parseInt(secMatch[1],10) : 0;
      const seconds = minutes*60 + secondsOnly;
      const rounds  = multMatch ? parseInt(multMatch[1],10) : 1;
      return { seconds, rounds };
    }

    function startTimer(seconds, rounds=1){
      resetTimer();
      remainingRounds = Math.max(1, rounds);
      timeLeft = seconds; isPaused=false; isRunning=true;
      document.getElementById('pauseBtn').textContent = 'PAUSE';
      updateDisplay(timeLeft);
      countdown = setInterval(tick, 1000);
    }
    function startSuggested(){ if(!suggestedSeconds) return; startTimer(suggestedSeconds, suggestedRounds); }

    function tick(){
      if (!isPaused && isRunning) {
        timeLeft--; updateDisplay(timeLeft);
        if (timeLeft <= 0) {
          playBeep();
          clearInterval(countdown); countdown=null; remainingRounds--;
          if (remainingRounds > 0) {
            setTimeout(() => { if(!isRunning) return; timeLeft = suggestedSeconds || timeLeft; updateDisplay(timeLeft); countdown = setInterval(tick, 1000); }, 800);
          } else {
            isRunning=false; document.getElementById('pauseBtn').textContent='PAUSE'; document.getElementById('timerDisplay').textContent='✔️';
          }
        }
      }
    }

    function togglePause(){ if(!isRunning) return; isPaused=!isPaused; document.getElementById('pauseBtn').textContent = isPaused ? 'RESUME' : 'PAUSE'; }

    function resetTimer(){ if(countdown){ clearInterval(countdown); countdown=null; } isPaused=false; isRunning=false; timeLeft=0; remainingRounds=1; updateDisplay(0); document.getElementById('pauseBtn').textContent='PAUSE'; stopBeep(); }

    function updateDisplay(v){ document.getElementById('timerDisplay').textContent = v; }

    function playBeep(){
      try { navigator.vibrate?.(200); } catch(e){}
      if (muted) return;
      const beep = document.getElementById('beep');
      beep.pause(); beep.currentTime = 0; beep.play().catch(()=>{});
    }
    function stopBeep(){ const beep = document.getElementById('beep'); beep.pause(); beep.currentTime = 0; }

    function onModalClose(){ resetTimer(); document.getElementById('modalImage').src=''; document.getElementById('modalTimeReps').textContent='—'; document.getElementById('modalInstructions').textContent='—'; releaseWakeLock(); }

    // Keyboard shortcuts only when modal open
    document.addEventListener('keydown', (e)=>{
      const isOpen = document.getElementById('exerciseModal').classList.contains('show');
      if(!isOpen) return;
      if(e.code==='Space'){ e.preventDefault(); togglePause(); }
      if(e.key.toLowerCase()==='r'){ resetTimer(); }
    });
  </script>
</body>
</html>