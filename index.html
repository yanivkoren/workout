<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <title>×™××œ×œ×” ×œ×–×•×–</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’ª</text></svg>">

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css">

  <script src="workouts.js"></script>

</head>

<body>




  <div class="container my-3">
    <div class="hero">
      <div class="hero-head d-flex align-items-center justify-content-between">
        <h2 class="m-0">×™××œ×œ×” ×œ×–×•×– ğŸ’ª</h2>
        <button class="btn btn-sm btn-ghost" id="muteBtn" aria-pressed="false" title="×”×©×ª×§ ×¦×œ×™×œ">ğŸ”Š</button>
      </div>
    </div>


    <!-- Tabs ×œ×‘×—×™×¨×ª ×¡×•×’ ××™××•×Ÿ -->
    <div id="workoutTabs" class="mb-3"></div>

    <!-- ×¨×©×ª ×”××™××•× ×™× (×‘×¨×™×¨×ª ××—×“×œ ××•×¦×’) -->
    <div id="workoutsGrid" class="row g-3 g-md-4"></div>

    <!-- ×ª×¦×•×’×ª ×”××™××•×Ÿ ×”× ×‘×—×¨ (×‘×”×ª×—×œ×” ××•×¡×ª×¨) -->
    <div id="workoutDetail" class="d-none"></div>

  </div>


  <div class="modal fade" id="exerciseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-heading">
            <div class="mh-emoji" id="modalEmoji">ğŸ’ª</div>
            <div>
              <h5 class="modal-title" id="modalTitle">×”×“×’××ª ×ª×¨×’×™×œ</h5>
              <div class="modal-subchips">
                <span class="badge-chip" id="modalMuscle">â€”</span>
                <span class="badge-chip" id="modalTimeChip">â€”</span>
              </div>
            </div>
          </div>
          <button type="button" class="btn-close ms-auto" data-bs-dismiss="modal" aria-label="×¡×’×•×¨"
            onclick="onModalClose()"></button>
        </div>

        <div class="modal-body">
          <div class="exercise-img-wrap mb-3">
            <img id="modalImage" class="exercise-img" src="" alt="×ª××•× ×” ×©×œ ×”×ª×¨×’×™×œ">
          </div>
          <div class="row g-3">
            <div class="col-12 col-lg-12">
              <div class="info-card p-3">
                <h6>×”×•×¨××•×ª ×‘×™×¦×•×¢</h6>
                <div id="modalInstructions">â€”</div>
              </div>
            </div>

          </div>

          <!------->

          <div id="controlsWrapper" class="controls collapsed mt-3">
            <!-- ×™×“×™×ª ×ª×—×ª×•× ×” ×××•×¨×›×–×ª: ××¦×™×’×” "×”×¦×’ ×˜×™×™××¨ â–²" ×›×©×”×˜×™×™××¨ ×¡×’×•×¨,
       ×•"â€×”×¡×ª×¨ â–¼" ×›×©×”×˜×™×™××¨ ×¤×ª×•×— -->
            <div class="controls-handle">
              <button id="controlsShowBtn" class="handle-btn" type="button" onclick="expandControls()"
                aria-expanded="false" aria-controls="timerControls">×”×¦×’ ×˜×™×™××¨ â–²</button>

              <button id="controlsHideBtn" class="handle-btn" type="button" onclick="collapseControls()"
                aria-expanded="true" aria-controls="timerControls">×”×¡×ª×¨ â–¼</button>
            </div>

            <!-- ×‘×§×¨×•×ª ×”×˜×™×™××¨ -->
            <div id="timerControls" class="controls-bar">
              <div class="container-fluid">
                <div class="row g-2 align-items-center">
                  <div class="col-12 col-lg-3">
                    <div id="timerDisplay" class="timer-display">0</div>
                    <div class="text-center mt-1">
                      <span class="badge text-bg-info me-1" id="suggestSeconds">××©×š ××•×¦×¢: â€”</span>
                      <span class="badge text-bg-secondary" id="suggestRounds">×¡×˜×™×: 1</span>
                    </div>
                  </div>
                  <div class="col-12 col-lg-6">
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                      <button class="btn btn-ghost btn-wide" onclick="startTimer(15)">15 ×©× ×³</button>
                      <button class="btn btn-ghost btn-wide" onclick="startTimer(30)">30 ×©× ×³</button>
                      <button class="btn btn-ghost btn-wide" onclick="startTimer(60)">60 ×©× ×³</button>
                      <button class="btn btn-ghost btn-wide" onclick="startTimer(120)">120 ×©× ×³</button>
                      <button id="startSuggestedBtn" class="btn btn-success btn-wide d-none"
                        onclick="startSuggested()">×œ×¤×™ ×”×ª×¨×’×™×œ</button>
                    </div>

                  </div>
                  <div class="col-12 col-lg-3">
                    <div class="d-flex flex-wrap gap-2 justify-content-center">
                      <button class="btn btn-warning btn-wide" id="pauseBtn" onclick="togglePause()">PAUSE</button>
                      <button class="btn btn-danger btn-wide" onclick="resetTimer()">RESET</button>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>


        </div>
      </div>
    </div>
  </div>

  <audio id="beep" preload="auto">
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
  </audio>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ===== × ×ª×•× ×™× =====
    const CATEGORIES = [
      "×—×™××•× ×›×œ×œ×™", "××™×¨×•×‘×™", "×—×™××•× ×™×™×¢×•×“×™", "××™××•×Ÿ ×›×—", "××™××•×Ÿ ×©×™×•×•×™ ××©×§×œ", "××™××•×Ÿ ×œ×™×‘×”", "××ª×™×—×•×ª"
    ];
    
    const CAT_ICON = {
  '×—×™××•× ×›×œ×œ×™': 'ğŸ”¥',
  '××™×¨×•×‘×™': 'ğŸƒ',
  '×—×™××•× ×™×™×¢×•×“×™': 'ğŸ¯',
  '××™××•×Ÿ ×›×—': 'ğŸ‹ï¸',
  '××™××•×Ÿ ×©×™×•×•×™ ××©×§×œ': 'ğŸ§˜',
  '××™××•×Ÿ ×œ×™×‘×”': 'ğŸ’ ',
  '××ª×™×—×•×ª': 'ğŸ§'
};


    let selectedType = 'gym';           // 'gym' ××• 'home'
    let selectedWorkoutId = null;       // id ×©×œ ××™××•×Ÿ ×¤×ª×•×— ×›×¨×’×¢ (××• null)
    let selectedCategory = 'all';       // ×§×˜×’×•×¨×™×” ×¤×¢×™×œ×” ×œ×¡×™× ×•×Ÿ


    // ===== ×¢×–×¨×™ × ×ª×•× ×™×: ×§×˜×’×•×¨×™×”/××™×§×•××™×/××™×—×•×“ ××™××•× ×™× =====
    function getWorkoutCategory(w) {
      if (w && typeof w.category === 'string' && w.category.trim()) return w.category.trim();
      if (w && w.plan && typeof w.plan === 'object') {
        for (const cat of CATEGORIES) {
          if (Array.isArray(w.plan[cat]) && w.plan[cat].length) return cat;
        }
      }
      return '××™××•×Ÿ ×›×—';
    }
    function normalizeLocations(w, fallback) {
      if (w && Array.isArray(w.locations) && w.locations.length) return [...new Set(w.locations)];
      return [fallback];
    }
    function getAllWorkouts() {
      const gym = Array.isArray(WORKOUTS?.gym) ? WORKOUTS.gym.map(w => ({...w, locations: normalizeLocations(w, 'gym')})) : [];
      const home = Array.isArray(WORKOUTS?.home) ? WORKOUTS.home.map(w => ({...w, locations: normalizeLocations(w, 'home')})) : [];
      return [...gym, ...home];
    }

    function countExercises(workout) {
        if (!workout || !workout.plan || typeof workout.plan !== 'object') return 0;
        return Object.values(workout.plan)
            .reduce((sum, v) => sum + (Array.isArray(v) ? v.length : 0), 0);
    }

    function pluralHe(n, one, many) {
        return n === 1 ? one : many; // ××—×–×™×¨ "×ª×¨×’×™×œ" ××• "×ª×¨×’×™×œ×™×"
    }


    // ×ª××•× ×ª ×‘×¨×™×¨×ª ××—×“×œ 1x1 ×©×§×•×¤×” (××•× ×¢×ª 404 ×× ×œ× ×¡×•×¤×§×” ×ª××•× ×” ×œ×ª×¨×’×™×œ)
    const DEFAULT_IMAGE = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";



function getVisibleWorkouts() {
  // WORKOUTS ×”×•× ××¢×¨×š ×™×—×™×“ (××”Ö¾workouts.js ×”×—×“×©)
  const byLocation = WORKOUTS.filter(w => Array.isArray(w.locations) && w.locations.includes(selectedType));
  if (selectedCategory === 'all') return byLocation;
  return byLocation.filter(w => w.category === selectedCategory);
}

function getUniqueCategoriesByLocation(type) {
  const arr = WORKOUTS.filter(w => w.locations?.includes(type));
  return Array.from(new Set(arr.map(w => w.category)));
}

function countByCategory(type) {
  const arr = WORKOUTS.filter(w => w.locations?.includes(type));
  const map = {};
  arr.forEach(w => { map[w.category] = (map[w.category] || 0) + 1; });
  return map;
}

function countExercises(workout) {
  return Array.isArray(workout?.exercises) ? workout.exercises.length : 0;
}
function pluralHe(n, one, many) { return n === 1 ? one : many; }






    // ===== Web Audio (iOS-friendly) =====
    let __AUDIO_CTX, __AUDIO_READY = false;
    function getCtx() {
      if (!__AUDIO_CTX) __AUDIO_CTX = new (window.AudioContext || window.webkitAudioContext)();
      if (__AUDIO_CTX.state === 'suspended') __AUDIO_CTX.resume();
      return __AUDIO_CTX;
    }
    // ×œ×§×¨×•× ×¤×¢× ××—×ª ×‘×œ×—×™×¦×” ×¢×œ Start (××—×•×•×” ××©×ª××©) ×›×“×™ "×œ×¤×ª×•×—" ××ª ×”××•×“×™×• ×‘××™×™×¤×•×Ÿ
    function initAudioOnce() {
      if (__AUDIO_READY) return;
      const ctx = getCtx();
      if (ctx.state === 'suspended') ctx.resume();
      __AUDIO_READY = true;
    }

    // ×¦×œ×™×œ ×‘×•×“×“ (×ª×•××š ×‘××¦×‘ mute ×”×§×™×™×)
    function playBeep(frequency = 440, duration = 0.18) {
      if (typeof muted !== 'undefined' && muted) return; // ×›×™×‘×•×“ ×›×¤×ª×•×¨ ×”×”×©×ª×§×”
      const ctx = getCtx();
      const now = ctx.currentTime;

      const osc = ctx.createOscillator();
      const gain = ctx.createGain();

      osc.type = 'sine';
      osc.frequency.value = frequency;

      // envelope ×¨×š
      gain.gain.setValueAtTime(0.11, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + duration);

      osc.connect(gain).connect(ctx.destination);
      osc.start(now);
      osc.stop(now + duration + 0.03);
    }


    // ×¢×•×–×¨ ×œ×¨×™×‘×•×™/×™×—×™×“
    function formatCount(n) {
      return n === 1 ? '××™××•×Ÿ 1' : `${n} ××™××•× ×™×`;
    }

    // ××©×¨×˜×˜ ××ª ×”×˜××‘×™× ×”×¢×œ×™×•× ×™× ×•××—×‘×¨ ×§×œ×™×§×™×
   function renderWorkoutTabs(active = null) {
  if (active) selectedType = active;

  const tabs = document.getElementById('workoutTabs');
  if (!tabs) return;

  // ××•× ×™× ×œ×¤×™ ××™×§×•×
  const gymCount  = WORKOUTS.filter(w => w.locations?.includes('gym')).length;
  const homeCount = WORKOUTS.filter(w => w.locations?.includes('home')).length;

  // ×§×˜×’×•×¨×™×•×ª ×–××™× ×•×ª ×œ×¤×™ ×”××™×§×•× ×©× ×‘×—×¨
  const cats = getUniqueCategoriesByLocation(selectedType);
  const catCounts = countByCategory(selectedType);

  tabs.innerHTML = `
    <div class="d-flex flex-column gap-2">
      <ul class="nav nav-pills justify-content-center gap-2 flex-wrap">
        <li class="nav-item">
          <button id="tab-gym" type="button"
                  class="nav-link ${selectedType==='gym'?'active':''}">
            ğŸ’ª ×—×“×¨ ×›×•×©×¨ <span class="badge text-bg-light ms-1">${gymCount}</span>
          </button>
        </li>
        <li class="nav-item">
          <button id="tab-home" type="button"
                  class="nav-link ${selectedType==='home'?'active':''}">
            ğŸ  ×‘×™×ª <span class="badge text-bg-light ms-1">${homeCount}</span>
          </button>
        </li>
      </ul>

      <ul class="nav nav-pills justify-content-center gap-2 flex-wrap">
        <li class="nav-item">
          <button id="cat-all" type="button"
                  class="nav-link ${selectedCategory==='all'?'active':''}">
            ×”×›×œ <span class="badge text-bg-light ms-1">
              ${WORKOUTS.filter(w => w.locations?.includes(selectedType)).length}
            </span>
          </button>
        </li>
        ${cats.map(c => `
          <li class="nav-item">
            <button type="button"
                    class="nav-link ${selectedCategory===c?'active':''}"
                    data-cat="${c}">
              ${(CAT_ICON[c]||'')} ${c}
              <span class="badge text-bg-light ms-1">${catCounts[c]||0}</span>
            </button>
          </li>
        `).join('')}
      </ul>
    </div>
  `;

  // ×××–×™× ×™×
  tabs.querySelector('#tab-gym')?.addEventListener('click', () => {
    selectedType = 'gym'; selectedCategory = 'all';
    renderWorkoutTabs(); renderWorkoutList(); showListHideDetail();
  });
  tabs.querySelector('#tab-home')?.addEventListener('click', () => {
    selectedType = 'home'; selectedCategory = 'all';
    renderWorkoutTabs(); renderWorkoutList(); showListHideDetail();
  });
  tabs.querySelector('#cat-all')?.addEventListener('click', () => {
    selectedCategory = 'all'; renderWorkoutTabs(); renderWorkoutList();
  });
  tabs.querySelectorAll('[data-cat]')?.forEach(btn => {
    btn.addEventListener('click', () => {
      selectedCategory = btn.getAttribute('data-cat');
      renderWorkoutTabs(); renderWorkoutList();
    });
  });
}



    function selectType(type) {
      if (type === selectedType) return;
      selectedType = type;
      selectedWorkoutId = null;
      renderWorkoutTabs(type);
      renderWorkoutList();
      showListHideDetail();
    }
  
    function renderWorkoutList() {
  const root = document.getElementById('workoutsGrid');
  if (!root) return;

  const arr = getVisibleWorkouts();
  root.innerHTML = '';

  if (arr.length === 0) {
    root.innerHTML = `<div class="col-12">
      <div class="text-center text-muted py-4">××™×Ÿ ××™××•× ×™× ×œ×”×¦×’×” ×›×¨×’×¢.</div>
    </div>`;
    return;
  }

  arr.forEach(w => {
    const exCount = countExercises(w);
    const locBadge = (w.locations?.includes('gym') && w.locations?.includes('home'))
      ? 'ğŸ’ªğŸ ' : (w.locations?.includes('gym') ? 'ğŸ’ª' : 'ğŸ ');

    const col = document.createElement('div');
    col.className = 'col-12 col-md-6 col-lg-4';

    col.innerHTML = `
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fs-4">${w.emoji || 'ğŸ‹ï¸'}</div>
            <div class="badge text-bg-secondary">${locBadge}</div>
          </div>
          <h5 class="card-title">${w.title || ''}</h5>
          <div class="text-muted small mb-2">
            ${w.category} Â· ${exCount} ${pluralHe(exCount,'×ª×¨×’×™×œ','×ª×¨×’×™×œ×™×')}
          </div>
          <p class="card-text text-muted">~ ${w.minutes || 0} ×“×§×³</p>
          <div class="mt-auto">
            <button class="btn btn-primary w-100 start-workout" data-id="${w.id}">×¤×ª×— ××™××•×Ÿ</button>
          </div>
        </div>
      </div>`;

    col.querySelector('.start-workout')?.addEventListener('click', (e) => {
      const id = e.currentTarget.getAttribute('data-id');
      if (id) openWorkout(id);
    });

    root.appendChild(col);
  });
}


function openWorkout(id) {
  const workout = WORKOUTS.find(w => w.id === id);
  if (!workout) return;

  selectedWorkoutId = id;

  const detail = document.getElementById('workoutDetail');
  detail.innerHTML = `
    <div class="workout-head">
      <button class="back-btn" type="button" onclick="backToList()">â† ×—×–×¨×”</button>
      <h3 class="mb-0">${workout.emoji || 'ğŸ’ª'} ${workout.title}</h3>
      <span class="ms-2 text-secondary">${workout.minutes ? `${workout.minutes} ×“×§×³` : ''}</span>
    </div>
    <div class="text-muted mb-2">${CAT_ICON[workout.category] || ''} ${workout.category}</div>
    <div id="wd-body" class="row g-3 g-md-4"></div>
  `;

  buildExercisesGrid(workout.exercises, 'wd-body', workout.category);
  showDetailHideList();
}

function buildExercisesGrid(exercises, containerId, categoryLabel) {
  const root = document.getElementById(containerId);
  if (!root) return;
  root.innerHTML = '';

  const col = document.createElement('div');
  col.className = 'col-12 col-lg-8';

  col.innerHTML = `
    <div class="cat-card h-100">
      <div class="cat-header">
        <div class="cat-emoji">${CAT_ICON[categoryLabel] || 'ğŸ·ï¸'}</div>
        <div class="cat-title">${categoryLabel}</div>
        <div class="cat-meta">${exercises.length} ${pluralHe(exercises.length,'×ª×¨×’×™×œ','×ª×¨×’×™×œ×™×')}</div>
      </div>
      <div class="cat-body" id="ex-list"></div>
    </div>
  `;
  root.appendChild(col);

  const body = col.querySelector('#ex-list');
  exercises.forEach((ex) => {
    const row = document.createElement('button');
    row.className = 'ex-mini w-100 text-start btn btn-light mb-2';
    row.type = 'button';
    row.innerHTML = `
      <div class="d-flex align-items-center gap-3">
        <img class="ex-thumb" src="${ex.imageURL || ''}" alt="${ex.nameHe || ex.nameEn || ''}" loading="lazy" decoding="async">
        <div class="flex-grow-1">
          <div class="fw-semibold">${ex.nameHe}<br>${ex.nameEn}</div>
          <div class="text-muted small">${ex.muscle || ''}</div>
        </div>
        <div class="text-nowrap text-muted small">${ex.timeReps || ''}</div>
      </div>
    `;
    row.addEventListener('click', () => openExercise(ex, categoryLabel));
    body.appendChild(row);
  });
}



    function backToList() {
      selectedWorkoutId = null;
      showListHideDetail();
    }
    function showDetailHideList() {
      document.getElementById('workoutsGrid').classList.add('d-none');
      document.getElementById('workoutDetail').classList.remove('d-none');
      document.getElementById('workoutTabs')?.classList.add('d-none');
    }
    function showListHideDetail() {
      document.getElementById('workoutDetail').classList.add('d-none');
      document.getElementById('workoutsGrid').classList.remove('d-none');
      document.getElementById('workoutTabs')?.classList.remove('d-none');

    }


    function emojiForCategory(cat) {
      return (typeof CAT_ICON !== 'undefined' && CAT_ICON[cat]) ? CAT_ICON[cat] : 'ğŸ’ª';
    }


    function buildPlanGrid(plan, mountId) {
      const grid = document.getElementById(mountId);
      if (!grid) return;
      grid.innerHTML = '';

      // ×¡×“×¨ ×œ×¤×™ CATEGORIES, ××¦×™×’ ×¨×§ ×§×˜×’×•×¨×™×•×ª ×©××•×¤×™×¢×•×ª ×‘-plan
      CATEGORIES.forEach(cat => {
        const list = (plan && plan[cat]) ? plan[cat] : null;
        if (!list || !list.length) return;

        const cardCol = document.createElement('div');
        cardCol.className = 'col-12 col-md-6 col-lg-4';
        cardCol.innerHTML = `
      <div class="cat-card h-100" data-cat="${cat}">
        <div class="cat-header">
          <div class="cat-emoji">${CAT_ICON[cat] || "ğŸ·ï¸"}</div>
          <div class="cat-title">${cat}</div>
          <div class="cat-meta">${list.length} ×ª×¨×’×™×œ×™×</div>
        </div>
        <div class="cat-body" id="cat-body-${slug(cat)}"></div>
      </div>`;
        grid.appendChild(cardCol);

        const body = cardCol.querySelector(`#cat-body-${slug(cat)}`);
        list.forEach((ex, i) => {
          const row = document.createElement('button');
          row.className = 'ex-mini w-100 text-start btn btn-link';
          row.type = 'button';
          //if (i > 2) { row.dataset.hidden = '1'; row.style.display = 'none'; }
          row.innerHTML = `
        <img class="ex-thumb" loading="lazy" alt="" src="${ex.imageURL || ''}">
        <div class="flex-grow-1">
          <div class="ex-name">${ex.name}</div>
          <div class="ex-sub">${ex.muscle} Â· ${ex.timeReps || ''}</div>
        </div>`;
          row.addEventListener('click', () => openExercise(ex, cat));
          body.appendChild(row);
        });
      });
    }


    function slug(s) { return (s || '').replace(/\s+/g, '-').replace(/[^\u0590-\u05FF\w-]/g, ''); }


    // ===== Modal + timer logic =====
    const exerciseModal = new bootstrap.Modal(document.getElementById('exerciseModal'));
    let suggestedSeconds = null, suggestedRounds = 1;
    let countdown = null, timeLeft = 0, isPaused = false, isRunning = false, remainingRounds = 1;
    let muted = false;

    document.getElementById('muteBtn').addEventListener('click', () => {
      muted = !muted;
      const btn = document.getElementById('muteBtn');
      btn.textContent = muted ? 'ğŸ”‡' : 'ğŸ”Š';
      btn.setAttribute('aria-pressed', String(muted));
    });

    function openExercise(ex, category) {
      // ×ª××•× ×”
      document.getElementById('modalImage').src = ex.imageURL || DEFAULT_IMAGE;

      // ×›×•×ª×¨×ª + ×ª×ª×™Ö¾×©×‘×‘×™×
      document.getElementById('modalTitle').innerHTML = `${ex.nameHe}<br>${ex.nameEn}`;
      document.getElementById('modalMuscle').textContent = ex.muscle || 'â€”';
      document.getElementById('modalTimeChip').textContent = ex.timeReps || 'â€”';
      document.getElementById('modalEmoji').textContent = emojiForCategory(category);


      // ×”×•×¨××•×ª ×‘×™×¦×•×¢
      document.getElementById('modalInstructions').textContent = ex.instructions || 'â€”';

      // ×˜×™×™××¨ (×›××• ×©×”×™×”)
      resetTimer();
      const { seconds, rounds } = parseTimeReps(ex.timeReps);
      suggestedSeconds = seconds; suggestedRounds = rounds;
      document.getElementById('timerDisplay').textContent = seconds || 0;
      document.getElementById('suggestSeconds').textContent = seconds ? `××©×š ××•×¦×¢: ${seconds} ×©× ×™×•×ª` : '××©×š ××•×¦×¢: â€”';
      document.getElementById('suggestRounds').textContent = `×¡×˜×™×: ${rounds}`;
      document.getElementById('startSuggestedBtn').classList.toggle('d-none', !seconds);

      collapseControls();   // ×œ×”×©××™×¨: ×‘×¨×™×¨×ª ××—×“×œ â€“ ×”×˜×™×™××¨ ×¡×’×•×¨
      exerciseModal.show();
    }


    function parseTimeReps(str) {
      if (!str) return { seconds: 0, rounds: 1 };
      const minMatch = str.match(/(\d+)\s*(?:×“×§(?:×”|×•×ª)?)/);
      const secMatch = str.match(/(\d+)\s*(?:×©× (?:×™(?:×”|×•×ª)?)?|×©×³)/);
      const multMatch = str.match(/[Ã—xX]\s*(\d+)/);
      const minutes = minMatch ? parseInt(minMatch[1], 10) : 0;
      const secondsOnly = secMatch ? parseInt(secMatch[1], 10) : 0;
      const seconds = minutes * 60 + secondsOnly;
      const rounds = multMatch ? parseInt(multMatch[1], 10) : 1;
      return { seconds, rounds };
    }

    function startTimer(seconds, rounds = 1) {
      initAudioOnce(); // â† ×—×©×•×‘ ×œ-iOS: "×¤×•×ª×—" ××ª ×”-AudioContext ×‘××—×•×•×” ××©×ª××©
      resetTimer();
      remainingRounds = Math.max(1, rounds);
      timeLeft = seconds; isPaused = false; isRunning = true;
      document.getElementById('pauseBtn').textContent = 'PAUSE';
      updateDisplay(timeLeft);
      countdown = setInterval(tick, 1000);
    }

    function startSuggested() { if (!suggestedSeconds) return; startTimer(suggestedSeconds, suggestedRounds); }

    function tick() {
      if (!isPaused && isRunning) {
        timeLeft--;
        updateDisplay(timeLeft);

        // ğŸµ ×¡×¤×™×¨×” ×§×•×œ×™×ª ×‘×©×œ×•×© ×”×©× ×™×•×ª ×”××—×¨×•× ×•×ª
        if (timeLeft === 3 || timeLeft === 2 || timeLeft === 1) {
          playBeep(440, 0.15);           // ×‘×™×¤ ×§×¦×¨ ×¨×’×™×œ
        }
        if (timeLeft === 0) {
          playBeep(880, 0.15);           // ×‘×™×¤ ×’×‘×•×” ×‘×¡×™×•×
        }

        if (timeLeft <= 0) {
          // (×”×—×œ×§ ×”××§×•×¨×™ ×©×œ×š × ×©××¨)
          clearInterval(countdown); countdown = null; remainingRounds--;
          if (remainingRounds > 0) {
            setTimeout(() => {
              if (!isRunning) return;
              timeLeft = suggestedSeconds || timeLeft;
              updateDisplay(timeLeft);
              countdown = setInterval(tick, 1000);
            }, 800);
          } else {
            isRunning = false;
            document.getElementById('pauseBtn').textContent = 'PAUSE';
            document.getElementById('timerDisplay').textContent = 'âœ”ï¸';
          }
        }
      }
    }


    function togglePause() { if (!isRunning) return; isPaused = !isPaused; document.getElementById('pauseBtn').textContent = isPaused ? 'RESUME' : 'PAUSE'; }
    function resetTimer() { if (countdown) { clearInterval(countdown); countdown = null; } isPaused = false; isRunning = false; timeLeft = 0; remainingRounds = 1; updateDisplay(0); document.getElementById('pauseBtn').textContent = 'PAUSE'; stopBeep(); }
    function updateDisplay(v) { document.getElementById('timerDisplay').textContent = v; }


    function stopBeep() { const beep = document.getElementById('beep'); beep.pause(); beep.currentTime = 0; }

    function onModalClose() {
      resetTimer();
      document.getElementById('modalImage').src = '';
      document.getElementById('modalInstructions').textContent = 'â€”';
      collapseControls();            // â† ×œ×”×—×–×™×¨ ×œ××¦×‘ ×¡×’×•×¨ ×›×‘×¨×™×¨×ª ××—×“×œ
    }


    const controlsWrapper = document.getElementById('controlsWrapper');

    function expandControls() {
      if (!controlsWrapper) return;
      controlsWrapper.classList.remove('collapsed');
      document.getElementById('controlsShowBtn')?.setAttribute('aria-expanded', 'true');
      document.getElementById('controlsHideBtn')?.setAttribute('aria-expanded', 'true');
    }

    function collapseControls() {
      if (!controlsWrapper) return;
      controlsWrapper.classList.add('collapsed');
      document.getElementById('controlsShowBtn')?.setAttribute('aria-expanded', 'false');
      document.getElementById('controlsHideBtn')?.setAttribute('aria-expanded', 'false');
    }

    renderWorkoutTabs('gym');   // ×™×’×“×™×¨ selectedType='gym' ×›×‘×¨×™×¨×ª ××—×“×œ
    renderWorkoutList();   // ×™×‘× ×” ×¢×œ ×¡××š selectedType
    showListHideDetail();  // ××¦×‘ â€œ×¨×©×™××”â€

  </script>
</body>

</html>